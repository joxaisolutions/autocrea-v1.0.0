# Railway Configuration Guide - AUTOCREA

## Frontend Configuration (@autocrea/frontend)

### Networking Settings

**Domains:**
- Custom Domain: `autocrea.joxai.org`
- Generated Domain: `autocreafrontend-production.up.railway.app`
- Port: **Auto-detect** (or 3000 if manual)

**IMPORTANT:** Next.js uses port 3000 by default. Use "Auto-detect" or set port to 3000.

### Environment Variables

```env
# Clerk (LIVE/Production keys)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_live_YOUR_KEY
CLERK_SECRET_KEY=sk_live_YOUR_KEY

# Convex
NEXT_PUBLIC_CONVEX_URL=https://admired-curlew-59.convex.cloud
CONVEX_DEPLOYMENT=prod:admired-curlew-59

# Backend API
NEXT_PUBLIC_API_URL=https://autocreabackend-production.up.railway.app/api

# Port (Railway uses this)
PORT=3000

# Node Environment
NODE_ENV=production
```

### Build Settings

Railway auto-detects Next.js projects. Default commands:
- **Build**: `npm run build`
- **Start**: `npm start`

---

## Backend Configuration (@autocrea/backend)

### Networking Settings

**Domains:**
- Generated Domain: `autocreabackend-production.up.railway.app`
- Port: **8000** (Express server)

### Environment Variables

```env
# Server
PORT=8000
NODE_ENV=production

# Frontend URL
FRONTEND_URL=https://autocrea.joxai.org

# Clerk (LIVE/Production key)
CLERK_SECRET_KEY=sk_live_YOUR_KEY

# Convex
CONVEX_URL=https://admired-curlew-59.convex.cloud

# Anthropic AI
ANTHROPIC_API_KEY=sk-ant-YOUR_KEY
AI_MODEL=claude-3-5-sonnet-20241022
```

### Build Settings

- **Build**: `npm run build` (runs `tsc && tsc-alias`)
- **Start**: `npm start` (runs `node dist/index.js`)

---

## DNS Configuration (Cloudflare)

### CNAME Record for Frontend

```
Type: CNAME
Name: autocrea
Target: autocreafrontend-production.up.railway.app
Proxy: Can be enabled (Cloudflare orange cloud) or disabled (grey cloud)
TTL: Auto
```

**Current Status:** ✅ Configured correctly

### Clerk Subdomains (if needed)

```
Type: CNAME
Name: accounts.autocrea
Target: accounts.clerk.services
TTL: 3600
```

---

## Troubleshooting

### "Validating domain ownership" stuck

**Problem:** Domain stays in "Validating" status
**Solution:**
1. Verify port is set to 3000 or Auto-detect (NOT 8000 for frontend)
2. Check DNS CNAME is correct
3. Wait 5-10 minutes for DNS propagation
4. Try removing and re-adding the domain

### SSL Certificate Error (NET::ERR_CERT_COMMON_NAME_INVALID)

**Problem:** Browser shows SSL error
**Solution:**
1. Wait for Railway to validate domain first
2. Railway auto-generates SSL certificate after validation
3. Can take up to 15 minutes

### Port Conflicts

**Frontend (Next.js):**
- Default port: 3000
- Railway auto-detect: Recommended ✅
- Custom port: Use 3000

**Backend (Express):**
- Port: 8000 (configured in code)
- Railway respects this via PORT env var

---

## Quick Reference

### URLs

- **Frontend Production**: https://autocrea.joxai.org
- **Frontend Railway**: https://autocreafrontend-production.up.railway.app
- **Backend Railway**: https://autocreabackend-production.up.railway.app
- **Backend API**: https://autocreabackend-production.up.railway.app/api
- **Backend Health**: https://autocreabackend-production.up.railway.app/health

### Services Status

Check health:
```bash
curl https://autocreabackend-production.up.railway.app/health
```

Expected response:
```json
{
  "status": "ok",
  "environment": "production",
  "timestamp": "2025-10-27T20:29:29.000Z"
}
```

---

## Deployment Flow

1. **Push to GitHub** → Triggers Railway deployment
2. **Railway builds** → Runs `npm install && npm run build`
3. **Railway starts** → Runs `npm start`
4. **Health check** → Railway pings the service
5. **Domain validation** → If custom domain configured
6. **SSL certificate** → Auto-generated by Railway
7. **Service live** → Available at configured domains

---

## Security Checklist

- ✅ Use LIVE Clerk keys in production (pk_live_*, sk_live_*)
- ✅ Never commit .env files
- ✅ Configure CORS to only allow your domains
- ✅ Use HTTPS for all endpoints
- ✅ Enable Railway's security features
- ✅ Rotate API keys regularly

---

**Last Updated:** 2025-10-27
**Status:** Ready for production deployment
